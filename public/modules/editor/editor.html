<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DataConecta — Editor Pro</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">
  <style>
    :root{ --bg:#071029; --card:#0f1724; --muted:#9aa4b2; --accent:#4f46e5; color:#e6eef6; font-family:Inter,system-ui,Arial; }
    body{ margin:0; height:100vh; display:flex; align-items:center; justify-content:center; background: linear-gradient(180deg,#041025 0%, #071A2B 100%); }
    .panel{ width:95%; max-width:1200px; background:rgba(255,255,255,0.03); padding:20px; border-radius:12px; box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
    h1{ margin:0 0 8px 0; color:#fff; }
    p{ color:var(--muted); margin:0 0 18px 0; }
    .controls{ display:flex; gap:8px; margin-bottom:16px; }
    .btn{ background:var(--accent); color:#fff; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; }
    #app-root{ min-height:560px; }
  </style>
</head>
<body>
  <div class="panel">
    <h1>DataConecta — Editor Pro</h1>
    <p>Editor colaborativo (Fabric.js) — pulsa abrir editor.</p>
    <div class="controls">
      <button id="open-editor" class="btn">Abrir Editor</button>
      <button id="open-editor-standalone" class="btn">Abrir Editor (standalone)</button>
    </div>
    <div id="app-root"></div>
  </div>

  <script>
    async function loadModule(opts){
      const root = document.getElementById('app-root');
      root.innerHTML = '';
      try {
        const res = await fetch(opts.html, {cache:'no-cache'});
        const html = await res.text();
        root.innerHTML = html;
        if(opts.css && !document.querySelector(`link[data-module="${opts.name}"]`)){
          const link = document.createElement('link'); link.rel='stylesheet'; link.href=opts.css; link.setAttribute('data-module', opts.name); document.head.appendChild(link);
        }
        if(opts.js && !document.querySelector(`script[data-module="${opts.name}"]`)){
          await new Promise((res,rej)=> {
            const s = document.createElement('script'); s.src = opts.js; s.async=true; s.setAttribute('data-module', opts.name);
            s.onload = ()=> res(); s.onerror = (e)=> rej(e); document.body.appendChild(s);
          });
        }
        // try auto-init api
        const apiName = opts.name + 'API';
        if(window[apiName] && typeof window[apiName].init === 'function') {
          window[apiName].init({ realtimeUrl: location.origin, room: 'demo' }).catch(e=>console.warn(e));
        }
      } catch(err){ root.innerHTML = '<div style="padding:12px;background:#111;color:#fff;border-radius:8px">Error cargando módulo: '+err.message+'</div>'; }
    }

    document.getElementById('open-editor').addEventListener('click', ()=> loadModule({ name:'editor', html:'/modules/editor/editor.html', css:'/modules/editor/editor.css', js:'/modules/editor/editor.js' }) );
    document.getElementById('open-editor-standalone').addEventListener('click', ()=> window.open('/modules/editor/editor.html','_blank'));
  </script>
</body>
</html>
